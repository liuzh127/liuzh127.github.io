---
layout: post
title: Linux命令
categories: [Linux基础]
tags: [Linux命令]
---
#### 1. 文件和目录
**[创建文件]**`touch 文件名`  
**[创建目录]**`mkdir [-mp] 目录名`*-m手动配置目录权限，-p递归创建所有目录*  
**[删除文件/目录]**`rm [-rf] 文件名/目录名`*-r向下递归，-f强制删除*  
**[移动文件/目录]**`mv [-f] 源文件/目录 目标文件/目录`*-f强制删除*  
<!-- more -->
**[复制文件/目录]**`cp [-rf] 源文件/目录 目标文件/目录`*-r向下递归，-f强制删除*  
**[远程复制文件/目录]**`scp [-rvP] [端口] 源文件/目录 目标用户名@目标IP:目标文件/目录`*-r包含目录，-v显示进度，-P指定端口*  
**[修改文件/目录所属用户/组]**`chown [-R] [用户]:[组] 文件名/目录名`*-R向下递归*  
**[修改文件/目录权限]**`chmod [-R] 755 文件名/目录名`*-R向下递归*  
#### 2. 用户和组
**[创建组]**`groupadd 组名`  
**[创建用户]**`useradd [-g] [组名] 用户名`*-g指定用户所属组*  
**[删除组]**`groupdel 组名`  
**[删除用户]**`userdel [-r] 用户名`*-r同时删除主目录*  
**[变更用户所属组]**`usermod [-g] [组名] 用户名`*-g指定用户所属组*  
**[创建修改用户密码]**`passwd [-lud] 用户名`*-l即禁用用户,-u解锁用户，-d取消密码*  
**[切换用户]**`su - 新用户名`*-在切换用户的同时切换环境变量*  
#### 3. 内存和磁盘
**[/boot]**引导分区，存放Linux的Grub和内核源码，1G以上或不分区  
**[/]**根目录，该目录下一般只有目录  
**[swap]**交换空间，将硬盘上某个区域模拟为内存,只能由系统访问，为物理内存的2倍  
**[/home]**用户目录，不与根目录共享磁盘空间  
**[/tmp]**临时文件，需要定期清理  
**[/usr]**软件目录，存放系统基本程序以外的应用程序  
**[/srv]**数据目录，某些服务启动之后需要访问此目录  
**[/etc]**配置目录，配置文件存放于此目录  
**[/dev]**设备目录，设备都以文件类型存放于此目录  
**[/media]**挂载目录，临时挂载文件系统或者硬件设备  
**[/opt]**软件目录,第三方软件存储于此目录  
**[/proc]**存储当前的进程ID和CPU、内存的映射等，此目录位于内存，本身不占用磁盘空间  
**[/var]**主要放置系统执行过程中经常变化的文件，如缓存（cache）和登录文件（log file）  
**[查看磁盘信息]**`fdisk -l`  
**[查看一级子目录/文件大小]**`du -lh --max-depth=1`*-l链接和本体只记一次,-h方便阅读，--max-depth=1最深层数:1*  
**[挂载磁盘]**`mount -t [文件类型] [-o loop] 真实路径 挂载路径`*-t文件类型，-o loop挂载为硬盘分区*  
**[卸载磁盘]**`umount 挂载路径`  
**[查看总体占用情况]**`top`*实时展示系统资源占用，按C按照CPU倒序，按M按照内存倒序*  
**[查看内存占用情况]**`free -h [-m] [-g]`*-h方便阅读 -m以M为单位显示，-g以G为单位显示*  
**[查看磁盘占用情况]**`df -hT`*-h方便阅读，-T显示文件系统类型*  
**[查看CentOS系统版本]**`cat /etc/CentOS-release`  
**[查看物理CPU颗数]**`cat /proc/cpuinfo|grep "physical id"|sort|uniq`*服务器上几颗CPU就有几行*  
**[查看物理CPU总核数]**`cat /proc/cpuinfo|grep -P 'physical id|core id'`  
*每个physical id代表一颗CPU，core id代表这颗CPU上的核数，加起来就是物理CPU总核数*  
**[查看逻辑CPU总核数]**`cat /proc/cpuinfo|grep "processor"|wc -l`  
*物理CPU总核数<逻辑CPU总核数时，代表有CPU开启了多线程*  
**[查看物理CPU型号]**`cat /proc/cpuinfo|grep name`  
#### 4. 服务和端口
**[查看进程运行情况]**`ps -ef [--sort=-标题][|head -行数]`*--sort=-按特定列排序(有-倒序无-正序)，head -取前n行,标题为小写*  
**[查看进程资源占用情况]**`ps -aux [--sort=-标题][|head -行数]`*显示CPU和内存占用，其它同上*  
**[查看端口占用情况]**`ss [-tanp]|grep 端口`*-t显示TCP进程，-a显示所有sockets，-n不解析服务名称，-p显示使用socket的进程，grep过滤端口*  
#### 5. 网络
**[查看网卡信息]**`ip a`*a同ad、add、addr、address*  
**[修改网卡信息]**`vi /etc/sysconfig/network-scripts/ifcfg-网卡名`*NAME网卡名，ONBOOT开机自启，IPADDR是IP，PREFIX子网掩码24，GATEWAY网关*  
**[重启网络服务]**`systemctl restart network`*修改网卡信息后，需重启网络才会应用新配置*  
**[启用/禁用网卡]**`ip link set 网卡名 [up][down]`*up启用，down禁用*  
#### 6. vi编辑器
**[编辑信息]**`i`*i切换到输入模式*  
**[保存信息]**`[esc]:wq!`*[esc]切换到命令模式，:切换到底线命令模式，w保存文件，q退出程序，!强制执行*  
**[搜索信息]**`/关键字`*命令模式可用，全文搜索关键字并高亮，N上一个，n下一个，/nop取消高亮*  
**[跳转行数]**`shift+g/gg`*命令模式可用，光标跳转到尾行/首行*  
**[删除信息]**`ndd`*命令模式可用，删除光标以下n行，光标自动移到下一行*  
**[复制信息]**`nyy`*命令模式可用，复制光标以下n行*  
**[粘贴信息]**`p`*命令模式可用，从光标所在行的下一行开始粘贴*  
**[回退操作]**`u`*命令模式可用，回退操作，至上一步的状态*  
**[复原操作]**`[Ctrl]+r`*命令模式可用，复原操作，至下一步的状态*  
#### 7. 历史记录
**访问环境变量配置文件**  
`vi /etc/profile`  
**配置显示历史记录显示**  
`export HISTFILESIZE=10000`*保留一万条记录  
`export HISTSIZE=10000`输出倒数一万条记录  
`export HISTTIMEFORMAT="%Y-%m-%d %H:%M:%S"`  
**重新载入环境变量**  
`source /etc/profile`  
#### 8. 根目录扩容
##### 8.1 创建大于2T的硬盘分区
**[查看硬盘详细信息]**`fdisk -l`*类似/dev/vdb格式的才是物理磁盘*  
**[查看硬盘分区情况]**`lsblk`*列出全部硬盘的分区和挂载情况*  
**[进入分区工具]**`parted /dev/vdb`  
**[查看所选磁盘分区信息]**`(parted) p`  
**[建立GPT的磁盘标签]**`(parted) mklabel gpt`*创建磁盘分区表支持GPT*  
**[创建分区并分配大小]**`(parted) mkpart primary 0% 100%`*百分比的方式方便磁盘对齐*  
**[删除创建的分区]**`(parted) rm 编号`*使用p可以查到已创建分区的编号*  
**[退出分区工具]**`(parted) quit`  
**[格式化分区]**`mkfs.ext4 /dev/vdb1`*可将硬盘格式化为ext4格式*  
##### 8.2 将新建的分区挂载到原有的分区（原有的分区需要有卷组和逻辑卷）
**[查看物理卷信息]**`pvdisplay`*PV Name是物理卷的名字*  
**[查看卷组信息]**`vgdisplay`*VG Name是卷组的名字*  
**[查看逻辑卷信息]**`lvdisplay`*LV Name是逻辑卷的名字*  
**[为新建的分区创建物理卷]**`pvcreate /dev/vdb1`*缺省情况下物理卷名就是分区名*  
**[将新建的物理卷增加到卷组]**`vgextend cl /dev/vdb1`*cl是目标卷组名，/dev/vdb1是物理卷名*  
**[扩展指定逻辑卷]**`lvextend -l +100%FREE /dev/mapper/cl-root`*/dev/mapper/cl-root是指定逻辑卷名，+100%FREE代表增加卷组全部的空闲空间*  
**[同步逻辑卷文件系统]**`xfs_growfs /`*/是指定逻辑卷的挂载点，此命令用于调整逻辑卷后同步文件系统使调整生效*  
##### 8.3 将新建的分区直接挂载到指定挂载点（原有的分区没有卷组和逻辑卷时使用此方法）
**[新建挂载点]**`mkdir /back`*挂载点就是新磁盘的根目录*  
**[将格式化后的新分区挂载到挂载点]**`mount /dev/vdb1 /back`*/back是挂载点，/dev/vdb1是新分区名*  
**[创建开机自动挂载]**`vi /etc/fstab`*linux启动时会从/etc/fstab自动扫描挂载*  
```
/dev/vdb1                                 /dev/vdb1               ext4    defaults        0 2
```
##### 8.4 其它可能用到的命令
**[删除物理卷]**`pvremove /dev/vdb1`*/dev/vdb1是物理卷名*  
**[创建卷组]**`vgcreate cl /dev/vdb1 /dev/vdb2`*cl是卷组名，/dev/vdb1等是物理卷名*  
**[删除卷组]**`vgremove cl`*cl是卷组名*  
**[创建逻辑卷]**`lvcreate -n medol -L 2G cl`*model是逻辑卷名，2G是逻辑卷大小，cl是卷组名*  
**[格式化逻辑卷]**`mkfs.ext4 /dev/cl/medol`*/dev/cl/medol是逻辑卷名，ext4是文件系统格式，格式化之后的挂载与普通分区基本一致*  
**[删除逻辑卷]**`lvremove /dev/cl/medol`*/dev/cl/medol是逻辑卷名*  
#### 8. 重置CentOS7系统root账号密码
1.开机后在系统选择界面，按提示按`e`进入编辑模式。  
2.找到`linux16`所在行，去掉`rhgb`和`quiet`参数，在`UTF-8`之后添加`init=/usr/bin/bash`。  
3.按`Ctrl+X`重启系统，此时无需密码即可进入系统。  
4、以`rw`的方式重新挂载`/`，否则没有根目录的写权限。  
`mount -o remount,rw /`  
5.输入`passwd`后出现提示，按提示输入新的root用户密码，输入完成后按照提示再次输入新的root用户密码进行确认。(过于简单的密码会有风险提示，无视不影响修改)  
6.执行命令`touch / .autorelabel`使SElinux生效，否则可能无法正常启动系统。  
7.执行命令`exec /sbin/init`重启系统即可完成修改。  
