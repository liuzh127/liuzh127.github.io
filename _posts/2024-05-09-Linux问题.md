---
layout: post
title: Linux问题
categories: [Linux]
tags: [Linux]
---
#### 1. 卡在开机Logo进不去
按键`ESC`可显示具体报错信息  
按键`Ctrl+Alt+F2`可进入命令行模式  
按键`Ctrl+Alt+F7`可回到可视化模式  
#### 2. 历史记录保存更长时间
1.访问环境变量配置文件  
`vi /etc/profile`  
<!-- more -->
2.配置显示历史记录显示  
```
export HISTFILESIZE=10000
#保留一万条记录  
export HISTSIZE=10000
#输出倒数一万条记录  
export HISTTIMEFORMAT="%Y-%m-%d %H:%M:%S"
#历史记录显示命令执行时间
```  
3.重新加载环境变量  
`source /etc/profile`  
#### 3. 根目录扩容
1.创建大于2T的硬盘分区  
**[查看硬盘详细信息]**`fdisk -l`*类似/dev/vdb格式的才是物理磁盘*  
**[查看硬盘分区情况]**`lsblk`*列出全部硬盘的分区和挂载情况*  
**[进入分区工具]**`parted /dev/vdb`  
**[查看所选磁盘分区信息]**`(parted) p`  
**[建立GPT的磁盘标签]**`(parted) mklabel gpt`*创建磁盘分区表支持GPT*  
**[创建分区并分配大小]**`(parted) mkpart primary 0% 100%`*百分比的方式方便磁盘对齐*  
**[删除创建的分区]**`(parted) rm 编号`*使用p可以查到已创建分区的编号*  
**[退出分区工具]**`(parted) quit`  
**[格式化分区]**`mkfs.ext4 /dev/vdb1`*可将硬盘格式化为ext4格式*  
2.将新建的分区挂载到原有的分区（原有的分区需要有卷组和逻辑卷）  
**[查看物理卷信息]**`pvdisplay`*PV Name是物理卷的名字*  
**[查看卷组信息]**`vgdisplay`*VG Name是卷组的名字*  
**[查看逻辑卷信息]**`lvdisplay`*LV Name是逻辑卷的名字*  
**[为新建的分区创建物理卷]**`pvcreate /dev/vdb1`*缺省情况下物理卷名就是分区名*  
**[将新建的物理卷增加到卷组]**`vgextend cl /dev/vdb1`*cl是目标卷组名，/dev/vdb1是物理卷名*  
**[扩展指定逻辑卷]**`lvextend -l +100%FREE /dev/mapper/cl-root`*/dev/mapper/cl-root是指定逻辑卷名，+100%FREE代表增加卷组全部的空闲空间*  
**[同步逻辑卷文件系统]**`xfs_growfs /`*/是指定逻辑卷的挂载点，此命令用于调整逻辑卷后同步文件系统使调整生效*  
3.将新建的分区直接挂载到指定挂载点（原有的分区没有卷组和逻辑卷时使用此方法）  
**[新建挂载点]**`mkdir /back`*挂载点就是新磁盘的根目录*  
**[将格式化后的新分区挂载到挂载点]**`mount /dev/vdb1 /back`*/back是挂载点，/dev/vdb1是新分区名*  
**[创建开机自动挂载]**`vi /etc/fstab`*linux启动时会从/etc/fstab自动扫描挂载*  
`/dev/vdb1 /dev/vdb1 ext4 defaults 0 2`  
4.其它命令  
**[删除物理卷]**`pvremove /dev/vdb1`*/dev/vdb1是物理卷名*  
**[创建卷组]**`vgcreate cl /dev/vdb1 /dev/vdb2`*cl是卷组名，/dev/vdb1等是物理卷名*  
**[删除卷组]**`vgremove cl`*cl是卷组名*  
**[创建逻辑卷]**`lvcreate -n medol -L 2G cl`*model是逻辑卷名，2G是逻辑卷大小，cl是卷组名*  
**[格式化逻辑卷]**`mkfs.ext4 /dev/cl/medol`*/dev/cl/medol是逻辑卷名，ext4是文件系统格式，格式化之后的挂载与普通分区基本一致*  
**[删除逻辑卷]**`lvremove /dev/cl/medol`*/dev/cl/medol是逻辑卷名*  
#### 4. 重置`CentOS7`系统`root`账号密码
1.开机后在系统选择界面，按提示按`e`进入`grub`编辑模式  
2.找到`linux16`所在行，去掉`rhgb`和`quiet`参数，在`UTF-8`之后添加`init=/usr/bin/bash`  
3.按`Ctrl+X`重启系统，此时无需密码即可进入系统  
4、以`rw`的方式重新挂载`/`，否则没有根目录的写权限  
`mount -o remount,rw /`  
5.输入`passwd`后出现提示，按提示输入新的root用户密码  
6.输入完成后按照提示再次输入新的root用户密码进行确认(过于简单的密码会有风险提示，无视不影响修改)  
7.执行命令`touch / .autorelabel`使SElinux生效，否则可能无法正常启动系统  
8.执行命令`exec /sbin/init`重启系统即可完成修改  
#### 5. 移除`grub`密码
1.使用`USB引导盘`启动，在引导界面选择【Troubleshooting故障排除】  
2.进入后选择【Rescue a CentOS Linux system】  
3.短暂引导后，输入`1`回车以选择第一个选项  
4.运行以下命令来创建必要的`root`环境以使用已安装的`Linux`系统  
`chroot /mnt/sysimage`  
5.在`/etc/grub2-efi.cfg`文件中找到`grub`的密码行注释掉  
```
set superusers="root"
#password_pbkdf2 root grub.pbkdf2.sha512.10000.HASH
```
6.使用命令`exit`关闭临时`root`环境，重启系统  
#### 6. glibc升级失败紧急修复
**`glibc`升级失败后，除了`cd`外的大部分命令就都不能用了，只能进【救援模式】**  
1.引导盘启动，【Troubleshooting】->【Rescue a CentOS system】  
2.创建U盘挂载目录,不要直接挂载在`/mnt`  
`mkdir /mnt/cdrom`  
3.查看U盘的盘符  
`blkid`  
4.挂载U盘，我的U盘是`/dev/sda1`  
`mount  /dev/sda1 /mnt/cdrom`  
5.安装glibc的RPM包(一定要指定root,因为目前的根目录是U盘)  
`rpm -ivh /mnt/cdrom/Packages/glibc* --nodeps --root /mnt/sysimage --force`  
6.第一次重启时间会比较久  
`reboot`  
