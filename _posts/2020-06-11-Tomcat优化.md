---
layout: post
title: Tomcat优化
categories: [工具]
tags: [Tomcat]
---
#### 1. 按照日期切割catalina.out日志  
修改在tomcat/bin下的catalina.sh文件  
找到**CATALINA_OUT="$CATALINA_BASE"/logs/catalina.out**    
修改为**CATALINA_OUT="$CATALINA_BASE"/logs/catalina"-`date "+%Y-%m-%d"`".out**  
重新启动tomcat  
<!-- more -->
#### 2. shutdown.sh没有关闭tomcat进程  
修改tomcat下bin/catalina.sh文件，在最后添加以下内容:  
#设置记录CATALINA_PID   
#该设置会在启动时候bin下新建一个CATALINA_PID文件   
#关闭时候从CATALINA_PID文件找到pid，kill同时删除CATALINA_PID文件  
**if [ -z "$CATALINA_PID" ]; then**    
      **CATALINA_PID=$PRGDIR/CATALINA_PID**    
**fi**  
tomcat的shutdown.sh文件,在最后一行加上-force:  
**exec "$PRGDIR"/"$EXECUTABLE" stop -force "$@"**  
#### 3. 默认端口功能  
8005端口为远程服务启停端口  
8080端口为HTTP端口  
8443端口为HTTPS端口  
8009端口为AJP端口，APACHE能过AJP协议访问TOMCAT的8009端口  
#### 4. 设为服务开机自启
**查看是否本系统上已经安装了Java**  
`java -version`  
*openjdk version "1.8.0_161"*  
**查看java安装目录**  
`find / -name java`  
*/usr/bin/java*  
**使用如下命令对此文件逐级回溯，即可找到java的安装目录地址**  
`ls -lrt /usr/bin/java`  
*-rwxr-xr-x. 1 root root 7304 4月  11 2018 **/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-2.b14.el7.x86_64/jre/bin/java***  
**添加变量到setenv.sh***没有的话在/home/tomcat/bin/目录新建一个,catalina.sh需要调用*  
`vi /home/tomcat/bin/setenv.sh`  
```
JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-2.b14.el7.x86_64/jre
PATH=$JAVA_HOME/bin:$PATH
CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
CATALINA_PID="$CATALINA_BASE/tomcat-服务名.pid"
```
**设置启动脚本**  
`vi /usr/lib/systemd/system/tomcat-服务名.service`  
```
#/usr/lib/systemd/system/tomcat-服务名.service
[Unit]
Description=tomcat-服务名
After=syslog.target network.target remote-fs.target nss-lookup.target
[Service]
Type=forking
PIDFile=/home/tomcat/tomcat-服务名.pid
ExecStart=/home/tomcat/bin/startup.sh
ExecReload=/bin/kill -s HUP $MAINPID
ExecStop=/bin/kill -s QUIT $MAINPID
PrivateTmp=true
[Install]
WantedBy=multi-user.target
```
**设置开机自启服务**  
`systemctl enable tomcat-服务名`  
**取消开机自启服务**  
`systemctl disable tomcat-服务名`  
**启动服务**  
`systemctl start tomcat-服务名`  
**启动服务**  
`systemctl start tomcat-服务名`  
