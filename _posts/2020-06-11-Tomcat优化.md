---
layout: post
title: Tomcat优化
categories: [工具]
tags: [Tomcat]
---
#### 1. 按照日期切割catalina.out日志  
修改在tomcat/bin下的catalina.sh文件  
找到**CATALINA_OUT="$CATALINA_BASE"/logs/catalina.out**    
修改为**CATALINA_OUT="$CATALINA_BASE"/logs/catalina"-`date "+%Y-%m-%d"`".out**  
重新启动tomcat  
<!-- more -->
#### 2. shutdown.sh没有关闭tomcat进程  
修改tomcat下bin/catalina.sh文件，在最后添加以下内容:  
#设置记录CATALINA_PID   
#该设置会在启动时候bin下新建一个CATALINA_PID文件   
#关闭时候从CATALINA_PID文件找到pid，kill同时删除CATALINA_PID文件  
**if [ -z "$CATALINA_PID" ]; then**    
      **CATALINA_PID=$PRGDIR/CATALINA_PID**    
**fi**  
tomcat的shutdown.sh文件,在最后一行加上-force:  
**exec "$PRGDIR"/"$EXECUTABLE" stop -force "$@"**  
#### 3. 默认端口功能  
8005端口为远程服务启停端口  
8080端口为HTTP端口  
8443端口为HTTPS端口  
8009端口为AJP端口，APACHE能过AJP协议访问TOMCAT的8009端口  
#### 4. 设为服务开机自启
想要查看是否本系统上已经安装了Java。
直接用键盘输如Linux命令：java -version
`openjdk version "1.8.0_161"`  
`ls -lrt /usr/bin/java`lrt解析，知道无法最速，即为JDK的地址
**添加变量到setenv.sh***没有的话在/home/tomcat/bin/目录新建一个,catalina.sh需要调用*  
`vi /home/tomcat/bin/setenv.sh`  
```
JAVA_HOME=/opt/jdk1.8.0_161
PATH=$JAVA_HOME/bin:$PATH
CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
CATALINA_PID="$CATALINA_BASE/tomcat8_hcpt.pid"
```
设置启动脚本
`vi /usr/lib/systemd/system/tomcat8_hcpt.service`  
```
#/usr/lib/systemd/system/tomcat8_hcpt.service
[Unit]
Description=Tomcat8
After=syslog.target network.target remote-fs.target nss-lookup.target
[Service]
Type=forking
PIDFile=/usr/local/apache-tomcat-8.5.35/tomcat8_hcpt.pid
ExecStart=/usr/local/apache-tomcat-8.5.35/bin/startup.sh
ExecReload=/bin/kill -s HUP $MAINPID
ExecStop=/bin/kill -s QUIT $MAINPID
PrivateTmp=true
[Install]
WantedBy=multi-user.target
```
启动
systemctl enable tomcat8_hcpt
systemctl start tomcat8_hcpt
centos7+tomcat9自启动
添加变量到setclasspath.sh中,catalina.sh会调用
vi /usr/local/tomcat9/bin/setclasspath.sh
# -----------------------------------------------------------------------------
#  Set JAVA_HOME or JRE_HOME if not already set, ensure any provided settings
#  are valid and consistent with the selected start-up options and set up the
#  endorsed directory.
# -----------------------------------------------------------------------------
export JAVA_HOME=/usr/local/jdk
export JRE_HOME=/usr/local/jdk/jre
设置启动脚本
vi /usr/lib/systemd/system/tomcat9.service
#/usr/lib/systemd/system/tomcat9.service
[Unit]
Description=Tomcat9
After=syslog.target network.target remote-fs.target nss-lookup.target
[Service]
Type=oneshot
PIDFile=/usr/local/tomcat9/tomcat.pid
ExecStart=/usr/local/tomcat9/bin/startup.sh
ExecStop=/usr/local/tomcat9/bin/shutdown.sh
ExecReload=/bin/kill -s HUP $MAINPID
RemainAfterExit=yes
[Install]
WantedBy=multi-user.target
启动
systemctl enable tomcat9
systemctl start tomcat9
